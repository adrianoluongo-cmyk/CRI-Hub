<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<title>Status Autoparco</title>

<style>
body {font-family:'Segoe UI',Arial;background:#0a0a0a;color:white;padding:20px;}
h1{text-align:center;color:#00d4ff;margin-bottom:25px;}
.grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:15px;}
.categoria-titolo{grid-column:1/-1;background:#222;padding:10px;border-left:5px solid #ffcc00;color:#ffcc00;}
.card{background:#181818;border-radius:8px;padding:15px;border-left:12px solid;}
.bordo-verde{border-left-color:#2ecc71;}
.bordo-arancio{border-left-color:#f39c12;}
.bordo-rosso{border-left-color:#e74c3c;}
#loader{text-align:center;color:#aaa;padding:20px;}
</style>

</head>
<body>

<h1>Status Real-Time Autoparco</h1>

<div id="loader">Caricamento dati...</div>
<div id="fleet-grid" class="grid"></div>

<script>

const CSV_URL="https://docs.google.com/spreadsheets/d/e/2PACX-1vRMtO9pbvrr-yz1xMwquFeonWlhrwz6R_01HXu0swxX6tqrNok0Xjr6KRfIdYRnnGx8ZvjIoN_9vMQi/pub?output=csv";

const statiVerdi=[
"OPERATIVO","BACKUP CONV 1","SOMMA LOMBARDO",
"GALLARATE CONV 1","BACKUP CONV 2",
"GALLARATE CONV 2","BACKUP CONV SOMMA L.DO"
];

async function loadData(){

const loader=document.getElementById("loader");
const container=document.getElementById("fleet-grid");

try{

const res=await fetch(CSV_URL+"&t="+Date.now());
const text=await res.text();

const rows=text.split("\n");

let html="";
let currentCat="";

for(let i=1;i<rows.length;i++){

const cols=rows[i].split(",");
if(cols.length<4) continue;

const categoria=cols[0].replace(/"/g,"").trim();
const sigla=cols[1].replace(/"/g,"").trim();
const veicolo=cols[2].replace(/"/g,"").trim();
const status=cols[3].replace(/"/g,"").trim();

let color="bordo-rosso";
const s=status.toUpperCase();

if(statiVerdi.includes(s)) color="bordo-verde";
else if(s.includes("MANUTENZIONE")) color="bordo-arancio";

if(categoria!==currentCat){
currentCat=categoria;
html+=`<div class="categoria-titolo">${currentCat}</div>`;
}

html+=`
<div class="card ${color}">
<div><b>${sigla}</b></div>
<div>${veicolo}</div>
<div>${status}</div>
</div>`;

}

container.innerHTML=html;
loader.style.display="none";

}catch(e){

loader.innerText="Errore caricamento CSV";
console.log(e);

}

}

loadData();
setInterval(loadData,60000);

</script>

</body>
</html>
